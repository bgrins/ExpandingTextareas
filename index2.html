<!doctype html><html dl><head>
<title>ExpandingTextarea</title>
<style>
body {
  margin:0;
  background:#56565A;
}

body.demo-done #demo {
  margin:5em auto 7em auto;
}

#demo {
  width:25em;
  margin:12em auto 9em auto;
  -webkit-perspective:1200;
  -webkit-transform-origin:0 -50%;
/*  min-height:20em;*/
  -webkit-transition:all 1s;
}

.expanding, .expanding-clone {
  font-size:250%;
  padding:0.2em;
  background:rgba(255,255,255,0.95);
  -webkit-transition:all 1s;
  -webkit-transition-delay:0;
  max-height:10.4em;
  -webkit-transition-delay:200ms;
}
.expanding{
  z-index:1;
}
.expanding-clone {
  transition:opacity 200ms;
  opacity:0;
}
#demo.persp textarea {
  -webkit-transition:all 1s;
  -webkit-transform:  rotateY(28deg);
}
#demo pre {
  opacity:0;
  -webkit-transform:  rotateY(28deg) translateZ(-100px);
  display:block !important;
  z-index:-1;
  visibility:visible !important;
}
#demo.persp pre {
  opacity:0.4;
  -webkit-transition: opacity 500ms;
  -webkit-transition-delay:1s;
}
#narrative {
  width:40%;
  margin: 0 auto 5em auto;
  opacity:0;
  position:relative;
  background:white;
  padding:30px;
}
body.demo-done #narrative{
  opacity:1;
  top:0;
  -webkit-transition:all 600ms;
}
</style>

<script type='text/javascript' src='libs/jquery-1.11.0.js'></script>
<script type='text/javascript' src='expanding.js'></script>
</head>
<body>

<div id="demo">
  <textarea class="expanding"></textarea>
</div>

<div id="narrative">

  <h1>Expanding Textareas</h1>
  <p>By <a href="https://github.com/bgrins">@bgrins</a>.
    <a href="https://github.com/bgrins/ExpandingTextareas">GitHub Project</a>.</p>

  <h2>How does it work?</h2>
  <p>Magic</p>


  <h2>How do I use it?</h2>
  <button>Toggle</button>
  <p>Depends on jQuery. Automatically applies the plugin to any textarea with
    <code>expanding</code> class</p>

  <pre><code>&lt;script src='expanding.js&gt;&lt;/script&gt;
&lt;textarea class='expanding'&gt;&lt;/textarea&gt;</code></pre>


</div>

<script type='text/javascript'>
  $(function() {
    // initialisation stuff:
    $('textarea').expanding().focus();
    $('#demo').click(function(){
      $('textarea').focus()
    })
    $('button').click(function(){$('#demo').toggleClass('persp')})

    // intro before the narrative fades in.
    var introSeq = new $.Deferred()
    var introAnimation = new $.Deferred()
    introSeq.done(function(){
      // makes the narrative fade-in when the intro is done.
      $('body').addClass('demo-done')
      $('textarea').focus()
      setTimeout(function(){introAnimation.resolve()}, 1000) // CSS animation
    })

    // start the ghost typing
    setTimeout(function(){
      new TuringType(
        $('textarea')[0],
        "This is just a normal textarea...\n\nexcept it expands when you type!",
        { callback: function(){ introSeq.resolve(); }}
      )
    }, 500)

    // add the 3D effect mid-typing
    setTimeout(function(){
      $('#demo').addClass('persp')
    }, 4000)

    // immediately show narrative if user tries to scroll (prevents scrolling)
    $(window).on('DOMMouseScroll mousewheel', function (e) {
      if(e.originalEvent.detail > 0 || e.originalEvent.wheelDelta < 0) {
        introSeq.resolve()
      }
      //prevent page fom scrolling
      return false;
    });

    // re-allow scrolling when animation done
    introAnimation.done(function(){
      $(window).off('DOMMouseScroll mousewheel')
    })
  });
</script>

<!-- TuringType by @dmotz -->
<script type='text/javascript'>
// Generated by CoffeeScript 1.6.3
(function() {
  var floor, rand,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  rand = Math.random;

  floor = Math.floor;

  window.TuringType = (function() {
    TuringType.prototype.int = 100;

    TuringType.prototype.accuracy = .95;

    TuringType.prototype.keys = 'qwertyuiop[]asdfghjklzxcvbnm,./;-='.split('');

    function TuringType(el, text, options) {
      var accuracy, interval, tag, _ref;
      this.el = el;
      this.text = text;
      this.options = options != null ? options : {};
      this.type = __bind(this.type, this);
      if (!(this instanceof TuringType)) {
        return (function(func, args, ctor) {
          ctor.prototype = func.prototype;
          var child = new ctor, result = func.apply(child, args);
          return Object(result) === result ? result : child;
        })(TuringType, arguments, function(){});
      }
      if (typeof this.el === 'string') {
        this.el = document.querySelector(this.el);
      }
      this.len = this.text.length;
      this.i = 0;
      _ref = this.options, accuracy = _ref.accuracy, interval = _ref.interval, this.callback = _ref.callback;
      this.accuracy = accuracy != null ? accuracy : this.accuracy;
      this.int = interval != null ? interval : this.int;
      if (tag = this.el.tagName.toLowerCase() === 'textarea' || tag === 'input') {
        this.attr = 'value';
        this.el.focus();
      } else {
        this.attr = 'innerText';
      }
      this.type();
    }

    TuringType.prototype.type = function() {
      var _this = this;
      if (this.i === this.len) {
        return typeof this.callback === "function" ? this.callback() : void 0;
      }
      if (rand() > this.accuracy) {
        this.el[this.attr] += this.keys[floor(rand() * this.keys.length)];
        return this.timer = setTimeout(function() {
          _this.el[_this.attr] = _this.text.slice(0, _this.i);
          // console.log(_this.text.slice(0, _this.i))
          return _this.timer = setTimeout(_this.type, rand() * _this.int + _this.int * .8);
        }, this.int * 1.5);
      } else {
        this.el[this.attr] += this.text[this.i++];
        $(this.el).change()
        return this.timer = setTimeout(this.type, (function() {
          var t;
          t = rand() * _this.int + _this.int * .1;
          if (_this.text[_this.i] === ' ') {
            t += rand() * _this.int;
          }
          if (_this.text[_this.i] === '.' || _this.text[_this.i] === ',') {
            t += rand() * _this.int * 3;
          }
          if (rand() > .97) {
            t += _this.int * 2;
          }
          if (rand() > .95) {
            t += _this.int;
          }
          return t;
        })());
      }
    };

    TuringType.prototype.pause = function() {
      clearTimeout(this.timer);
      return this.el[this.attr];
    };

    return TuringType;

  })();

}).call(this);
</script>

</body>
</html>
